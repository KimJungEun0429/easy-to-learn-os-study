# 02 디스크 장치

* 대용량 데이터를 저장하기 위해 하드디스크를 많이 사용

## 1. 디스크 장치의 종류
### 1.1 하드디스크
> * 1956년에 처음 등장
> * 당시에는 테이프 드라이브 같이 순차적으로 데이터에 접근하는 저장장치밖에 없었음
> * 하드디스크는 원반을 사용한 저장장치로, 맨 앞에 있는 데이터나 맨 뒤에 있는 데이터에 접근하는 속도가 거의 비슷하여 수많은 시스템에서 본격적으로 하드디스크를 도입
> * 같은 용량의 메모리 보다 훨씬 싸고 데이터도 반영구적으로 저장할 수 있어 많이 사용되고 있음
> * 메모리를 보조하는 장치라는 의미에서 제 2 저장장치라고 불림
> * 하드디스크는 스핀들(spindle)이라는 원통축에 여러 개의 플래터(platter)가 달려 있음
> * 하드디스크는 구조상 외부 충격에 민감
> * 
> * 플래터
>   * 표면에 자성체가 발려 있어 자기를 이용하여 0과 1의 데이터를 저장할 수 있음
>   * 플래터의 표면이 N극을 띠면 0으로, S극을 띠면 1로 인식
>   * 플래터의 수는 하드디스크 마다 다르지만 보통 2장 이상으로 구성되며 항상 일정한 속도로 회전
>   * 하드디스크 사양 7500rpm -> 플래터가 1분에 7500바퀴를 돈다
>   * 보통은 2장 모두에 데이터를 저장하지만, 플래터 맨 아래 또는 맨 위 디스크의 바깥 면을 사용하지 않는 모델도 있음
>   * 3.5인치 지름의 플래터(일반 컴퓨터) 또는 2.5인치 지름의 플래터(휴대용)를 사용
> * 
> * 섹터와 블록
>   * 섹터는 물리적 개념
>   * 섹터는 하드디스크의 가장 작은 저장 단위
>   * 하나의 섹터에는 한 덩어리의 데이터가 저장
>   * 블록은 하드디스크와 컴퓨터 사이에 데이터를 전송하는 논리적인 저장 단위 중 가장 작은 단위
>   * 블록은 여러 개의 섹터로 구성되며, 윈도우 운영체제에서는 블록 대신 클러스터라고 표현
>   * 메모리에서는 물리적으로 하나의 바이트마다 주소가 배정되지만 하드디스크는 논리적인 단위인 블록마다 주소가 배정
>   * 하드디스크 입장에서는 섹터가 가장 작은 저장 단위지만 운영체제 입장에서는 하드디스크에 데이터를 보내거나 받을 때 블록이 가장 작은 단위
> * 
> * 트랙과 실린더
>   * 트랙은 플래터에서 회전축을 중심으로 데이터가 기록되는 동심원 == 동일한 동심원상에 있는 섹터의 집합
>   * 헤드는 디스크 암에 고정되어 있기 때문에 모든 헤드가 항상 같이 움직임
>   * 헤드는 여러 플래터의 같은 위치에 있는 트랙을 동시에 읽거나 쓸 수 있음
>   * 개념적으로 여러 개의 플래터에 있는 같은 트랙의 집합을 실린더라고 부름
> * 
> * 헤드와 플래터
>   * 하드디스크에서 데이터를 읽거나 쓸 때는 읽기/쓰기 헤드를 사용
>   * 헤드의 수는 데이터가 저장되는 플래터의 표면 수와 같음
>   * 플래터가 회전하면 표면에 약한 바람이 불고, 헤드는 이 바람에 의해 표면에서 약간 떠 있는 형태로 작동
>   * 헤드가 플래터에 붙어버리면 고속으로 회전하는 플래터의 표면에 상처가 생길 수 있음
>   * 플래터 표면에 상처가 생기면 데이터를 저장할 수 없는 배드 섹터가 됨
>   * 컴퓨터를 종료할 때 헤드가 플래터에 흠집을 내지 않도록 하드디스크는 헤드를 데이터가 저장되지 않는 플래터의 맨 바깥쪽으로 이동
>   * 이를 파킹이라고 함
>
### 1.2 CD
> * 휴대할 수 있는 소형 원반에 데이터를 저장
> * 트랙과 섹터로 구성
> * 수평으로 움직이는 헤드가 트랙 사이를 움직이면서 데이터를 읽음
> * 표면에 미세한 홈이 파여 있어 헤드에서 발사된 레이저가 홈에 들어가 반사가 되지 않으면 0으로, 반사되어 돌아오면 1로 인식
> * 레이저를 쏘아 표면을 태워 미세한 홈을 만드는 방식으로 데이터를 저장
>
### 1.3 하드디스크와 CD의 비교
> * 둘 다 원판을 사용하지만 구동 방식이 다름
> * 하드디스크는 성능을 나타내는 단위로 rpm을 사용하고, CD는 배속을 사용
> * 하드디스크의 경우 바깥쪽에서 안쪽으로 데이터가 채워지지만, CD의 경우는 반대로 동작
> * 하드디스크는 디스크가 동작하는 동안 플래터가 일정한 속도로 돌지만 CD는 헤드 위치에 따라 디스크의 회전 속도가 변함
> * 하드디스크의 각속도 일정 방식
>   * 하드디스크의 플래터는 항상 일정한 속도로 회전하여 바깥쪽 트랙의 속도가 안쪽 트랙의 속도보다 훨씬 빠름
>   * 가장 바깥에 있는 섹터가 가장 안쪽에 있는 섹터보다 더 큼
>   * 일정한 시간 동안 이동한 각도가 같다는 의미
>   * 안쪽 트랙에 비해 바깥쪽 트랙으로 갈수록 낭비되는 공간이 생김
>   * 구동 장치가 단순하고 조용하게 작동함
> * CD의 선속도 일정 방식
>   * 어느 트랙에서나 단위 시간당 기스크의 이동 거리가 같음
>   * 이를 구현하기 위해서 헤드가 안쪽 트랙에 있을 때는 디스크의 회전 속도를 빠르게 하고, 헤드가 바깥쪽 트랙으로 이동했을 때는 디스크의 회전 속도를 느리게 해야 함
>   * 모든 트랙의 섹터 수가 다름
>   * 공간 낭비 문제는 없음
>   * 모터 제어가 복잡하고 소음이 발생

## 2. 디스크 장치의 데이터 전송 시간
* 하드디스크의 특정 섹터에 저장된 데이터를 읽거나 쓰려면 그 섹터가 있는 트랙까지 헤드가 이동해야 함
* 현재 위치에서 그 트랙까지 이동하는데 걸리는 시간을 탐색시간(seek time)이라고 함
* 특정 트랙까지 이동한 헤드는 플래터가 회저하여 원하는 섹터를 만날 때까지 기다림
* 원하는 섹터를 만날 때까지 회전하는 데 걸리는 시간을 회전 지연 시간이라 함
* 헤드는 원하는 섹터에 있는 데이터를 읽어 전송
* 이 때 걸리는 시간을 전송시간이라고 함
* 하드디스크에서 데이터를 가져오는 데 걸리는 총시간 (데이터 전송 시간) = 탐색시간 + 회전 지연 시간 + 전송 시간

## 3. 디스크 장치 관리
### 3.1 파티션
> * 하드디스크 같은 대용량 저장장치를 구해하여 처음 사용할 때는 파티션을 나누고 포매팅을 한 다음 사용
> * 파티션이란 디스크를 논리적으로 분할하는 작업
> * 포매팅은 디스크를 초기화하는 작업
> * 보통 파티션 하나에 하나의 파일 시스템이 탑재
> * 하드디스크가 두 개라면 별도의 파티션으로 보임
> * 유닉스에는 여러 하드디스크를 하나의 파티션으로 통합하는 기능이 있음 == 마운트
>
### 3.2 포매팅
> * 파티션이 결정되면 포매팅을 해야 함
> * 포매팅은 디스크에 파일 시스템을 탑재하고 디스크 표면을 초기화하여 사용할 수 있는 형태로 만드는 작업
> * 가상 메모리 시스템은 가상 주소를 메모리의 물리 주소로 변환하기 위해 페이지 테이블을 사용
> * 저장 장치도 디스크에 저장된 파일의 위치와 크기 정보를 담고 있는 파일 테이블을 사용
> * 빈 저장장치에 파일 테이블을 탑재하는 것이 포매팅
> * 모든 운영체제는 고유의 파일 테이블을 가지고 있음(윈도우 - FAT/NTFS 유닉스 - I-node)
> * 포매팅은 이런 파일 시스템을 각 파티션의 상단부에 탑재하고 저장장치의 모든 섹터를 0으로 만들어 운영체제가 하드디스크를 사용할 수 있도록 준비하는 작업
> * 위의 설명은 느린 포매팅
> * 빠른 포매팅은 데이터는 그대로 둔 채 파일 테이블을 초기화하는 방식
> * 하드디스크를 처음 사용할 때는 느린 포매팅을 하고, 다시 포매팅을 해야 할 경우 빠른 포매팅을 진행
> * 느린 포매팅은 모든 섹터를 0으로 만드는 동시에 배드섹터를 찾는 일도 함
>
### 3.3 조각 모음
> * 하드디스크 처음에는 데이터가 앞에서부터 쌓이지만 파일을 저장했다 지우기를 하면 중간중간에 빈 공간이 생김 == 조각화/단편화
> * 조각이 많이 생기면 큰 파일이 여러 조각으로 나뉘어 저장되고 이를 읽기 위해 하드디스크의 여러 곳을 돌아다녀야 하기 때문에 성능 저하
> * 주기적으로 조각 모음을 해야 함
> * 조각 모음은 시간이 많이 걸리는 작업으로 윈도우는 작업이 없는 특정 시간에 조각 모음을 실행하도록 설정할 수 있음
> * USB나 SSD처럼 반도체를 이용한 저장장치는 조각 모음을 하지 않아도 됨
> 

## 4. 네트워크 저장장치
* 개인용 휴대 장치가 발달 -> 장치마다 독립적인 저장 장치가 있음 -> 데이터의 중복 / 관리 어려움
* 네트워크의 발달 덕분에 원격에서 저장장치를 사용할 수 있음
* 어떻게 구성하느냐에 따라 DAS, NAS, SAN으로 구분
### 4.1 DAS (Direct Attached Storage)
> * == HAS (Host Attached Storage)
> * 서버와 같은 컴퓨터에 직접 연결된 저장장치
> * DAS는 컴퓨터의 메인보드에 있는 입출력 버스와 연결
> * 버스를 사용하는 방식은 IDE -> E-IDE -> SATA로 변화
> * 변화는 연결의 간편성, 최대 전송 속도와 연관됨
> * DAS는 외부 저장장치와 컴퓨터 내부 버스를 연결하는 데 범용 연결단자인 USB 또는 Firewire(IEEE1394) 사용
> * 다른 운영체제가 쓰는 파일 시스템을 사용할 수 없음
> * 데이터 관리나 백업을 사용자가 직접해야 하는 번거로움
> 
### 4.2 NAS (Network Attached Storage)
> * 기존의 저장장치를 LAN이나 WAN에 붙여서 사용하는 방식
> * NAS 전용 운영체제를 가진 독립적인 장치
> * 새로운 하드디스크를 추가하거나 뺄 수 있음
> * 저장장치를 네트워크상에 두고 여러 클라이언트가 네트워크를 통해 접근하게 함으로써 공유 데이터의 관리 및 데이터의 중복 회피가 가능
> * 사용자 인터페이스를 사용하여 다양한 파일 관리가 가능
> * 일부 무선 공유기에 USB 단자가 있어 하드디스크만 연결하면 NAS 형태로 구현할 수 있음
> * 최근 NAS는 WAN을 이용해서 외부에서 집에 있는 데이터를 주고 받을 수 있음
>
### 4.3 SAN (Storage Area Network)
> * 데이터 서버, 백업 서버, RAID 등의 장치를 네트워크로 묶고 데이터 접근을 위한 서버를 두는 형태
> * 시스템이 제공하는 인터페이스를 통해 데이터에 접근
> * 편리하지만 데이터 서버나 백업 서버를 같이 구축하기 때문에 NAS 보다 구축 비용이 많이 듦