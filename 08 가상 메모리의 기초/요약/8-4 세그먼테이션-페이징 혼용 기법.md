# 8-4. 세그먼테이션-페이지 혼용 기법

## 1. 메모리 접근 권한

### 메모리 제어 방식

| 구분 | 읽기 | 쓰기 / 추가 | 실행 | 비고 |
| --- | --- | --- | --- | --- |
| 모드0 | X | X | X | 접근 불가 |
| 모드1 | X | X | O | 실행만 가능 |
| 모드2 | X | O | X | 실제로 사용X |
| 모드3 | X | O | O | 실제로 사용X |
| 모드4 | O | X | X | 읽기 전용 |
| 모드5 | O | X | O | 읽고 실행 가능 |
| 모드6 | O | O | X | 읽고 쓰기 가능 |
| 모드7 | O | O | O | 제한 없음 |

### 프로세스 영역별 메모리 접근 권한

| 프로세스 | read | write | execute |  |
| --- | --- | --- | --- | --- |
| 코드 영역 (PCB) | O | X | O | 자기 자신을 수정하는 프로그램은 없기 때문에 읽기/실행만 |
| 데이터 영역 | O | O / X | X | 일반적인 변수 : 읽기, 쓰기
상수 : 읽기 |
| 스택 영역 |  |  |  |  |
- 가상 주소에서 물리 주소로 **주소 변환**이 일어날 때마다 **메모리 접근 권한 검사** 수행
- **매핑 테이블**에 메모리 접근 권한 정보가 저장되어 있음

## 2. 세그먼테이션-페이징 혼용 기법의 도입

### 페이징 기법의 메모리 접근 권한 설정

![https://user-images.githubusercontent.com/57691894/197327188-b3078354-c3ca-48cd-9006-31863fca85f8.png](https://user-images.githubusercontent.com/57691894/197327188-b3078354-c3ca-48cd-9006-31863fca85f8.png)

- 페이지의 모든 행에 메모리 접근 권한 비트(right bit) 추가
- 인접한 페이지는 메모리 접근 권한이 같음에도 매 페이지마다 권한 비트 설정 → **메모리 낭비**

### 페이징 테이블과 세그먼테이션 테이블 혼합

![https://user-images.githubusercontent.com/57691894/197327365-ffca5797-c7ed-48af-ad7a-81d9b38e6b84.png](https://user-images.githubusercontent.com/57691894/197327365-ffca5797-c7ed-48af-ad7a-81d9b38e6b84.png)

- 서로 관련 있는 페이지들을 하나의 세그먼트로 관리
- 세그먼테이션 테이블에 권한 비트, 페이지 테이블의 시작 주소 저장
- 권한 비트, (유닉스 체제) 소유 권한 등을 저장하여 데이터를 줄일 수 있음

## 3. 세그먼테이션-페이징 혼용 기법의 주소 변환

### 세그먼테이션-페이징 혼용 기법을 이용한 가상 메모리 시스템의 전체 구조

![https://user-images.githubusercontent.com/57691894/197329089-94c4d42a-6a95-4a6d-b2fd-c8141fb4b25b.png](https://user-images.githubusercontent.com/57691894/197329089-94c4d42a-6a95-4a6d-b2fd-c8141fb4b25b.png)

- 사용자 입장 : 세그먼테이션 기법
- 메모리 관리자 입장 : 페이징 기법

### 주소 변환

```
가상주소 VA = <S, P, D>

S : 세그먼트 번호 / P : 페이지 번호 / D : 페이지의 처음 위치에서 해당 주소까지의 거리
```

1. 사용자가 데이터 요청 → 가상주소 구한다.
2. 세그먼테이션 테이블의 해당 세그먼트 번호 확인하여 접근 권한 확인
    - 권한이 없으면 세그먼테이션 오류(트랩) 발생 → 프로세스 강제 종료
3. 페이지 테이블에서 해당 페이지의 프레임 확인
    - 프레임이 없으면 스왑 영역에 가서 해당 페이지를 물리 메모리로 가져온다.
4. 물리 메모리에 있는 프레임의 처음 위치에서 D만큼 떨어진 곳 접근 → 데이터 읽기/쓰기

---

- 이미지 출처 : [https://velog.io/@chappi/OS는-할껀데-핵심만-합니다.-15편-가상-메모리-세그먼테이션-세그먼테이션-페이징-혼용-기법](https://velog.io/@chappi/OS%EB%8A%94-%ED%95%A0%EA%BB%80%EB%8D%B0-%ED%95%B5%EC%8B%AC%EB%A7%8C-%ED%95%A9%EB%8B%88%EB%8B%A4.-15%ED%8E%B8-%EA%B0%80%EC%83%81-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%85%8C%EC%9D%B4%EC%85%98-%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%85%8C%EC%9D%B4%EC%85%98-%ED%8E%98%EC%9D%B4%EC%A7%95-%ED%98%BC%EC%9A%A9-%EA%B8%B0%EB%B2%95)
